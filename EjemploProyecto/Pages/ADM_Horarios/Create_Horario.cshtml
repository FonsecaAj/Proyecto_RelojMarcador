@page
@model EjemploProyecto.Pages.ADM_Horarios.Create_HorarioModel
@{
    ViewData["Title"] = "Crear Horario";
}

<link rel="stylesheet" href="~/css/Estilos.css">

<h2>Crear Nuevo Horario</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<form method="post" id="horarioForm">
    <!-- Identificación del usuario -->
    <div class="form-group mb-3">
        <label class="control-label">Identificación del Usuario</label>
        <input asp-for="Horario.Identificacion" class="form-control" readonly />
        <span asp-validation-for="Horario.Identificacion" class="text-danger"></span>
    </div>

    <!-- áreas -->
    <div class="form-group mb-3">
        <label class="control-label">Área en la que trabaja</label>
        <select id="selectArea" asp-for="Horario.ID_Area" class="form-control" onchange="actualizarCodigoArea()">
            <option value="">Seleccione un área</option>
            @if (Model.AreasDisponibles != null && Model.AreasDisponibles.Any())
            {
                foreach (var area in Model.AreasDisponibles)
                {
                    <option value="@area.ID_Area" data-codigo="@area.Codigo_Area" data-nombre="@area.Nombre_Area">
                        @area.Nombre_Area
                    </option>
                }
            }
        </select>
        <span asp-validation-for="Horario.ID_Area" class="text-danger"></span>
    </div>

    <!-- Código de área -->
    <div class="form-group mb-3">
        <label class="control-label">Código del Área</label>
        <input asp-for="Horario.Codigo_Area" class="form-control" id="codigoArea" readonly />
        <span asp-validation-for="Horario.Codigo_Area" class="text-danger"></span>
    </div>

    <!-- Campo hidden para Nombre_Area -->
    <input type="hidden" asp-for="Horario.Nombre_Area" id="nombreArea" />

    <!-- Botón crear -->
    <div class="form-group">
        <button type="submit" class="btn btn-primary">Crear Horario</button>
        <a asp-page="/ADM_Horarios/Detalle_Horarios" asp-route-id="@Model.Horario.Identificacion" class="btn btn-secondary">Volver</a>
    </div>
</form>

@section Scripts {
    <script>
        function actualizarCodigoArea() {
            const select = document.getElementById("selectArea");
            const selectedOption = select.options[select.selectedIndex];
            const codigo = selectedOption?.getAttribute("data-codigo") || "";
            const nombre = selectedOption?.getAttribute("data-nombre") || "";

            document.getElementById("codigoArea").value = codigo;
            document.getElementById("nombreArea").value = nombre;
        }

        document.getElementById('horarioForm').addEventListener('submit', function(e) {
            const idArea = document.querySelector('[name="Horario.ID_Area"]').value;
            const nombreArea = document.getElementById('nombreArea').value;

            if (!idArea || idArea === '') {
                alert('Por favor selecciona un área');
                e.preventDefault();
                return;
            }

            if (!nombreArea) {
                alert('Error al cargar el nombre del área');
                e.preventDefault();
                return;
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            actualizarCodigoArea();
        });
    </script>
}